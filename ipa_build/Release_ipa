#!/bin/bash

# è·å–å·¥ç¨‹æ ¹ç›®å½•
fadir()  
{  
    local this_dir=`pwd`  
    local child_dir="$1" 
    dirname "$child_dir" 
    cd $this_dir  
} 
CUR_DIR=$(cd `dirname $0` && pwd -P )
PROJ_BIN=`fadir $CUR_DIR`
echo "å½“å‰æ–‡ä»¶è·¯å¾„ $CUR_DIR"
echo "å½“å‰æ–‡ä»¶è·¯å¾„ä¸Šä¸€çº§ $PROJ_BIN"

echo "

ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹æ‰“åŒ…Release! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  

"
#å·¥ç¨‹ç»å¯¹è·¯å¾„
cd $PROJ_BIN
project_path=$(pwd)
echo "å·¥ç¨‹è·¯å¾„ $project_path"
# è¾“å‡ºåˆ°æ¡Œé¢
output_path=~/Desktop
#è·å–å·¥ç¨‹é»˜è®¤schemeçš„åå­—ï¼ˆé»˜è®¤ä¸å·¥ç¨‹æ–‡ä»¶åå­—ç›¸åŒï¼‰
scheme_name=$(echo $(basename ./*.xcodeproj) | awk -F. '{print $1}')
# è·å–æ—¶é—´ å¦‚:201706011145
current_date="$(date +%Y%m%d_%H%M%S)"
# æŒ‡å®šè¾“å‡ºipaè·¯å¾„
export_path="${output_path}/${scheme_name}_${current_date}"
export_path_ipa="${export_path}/${scheme_name}.ipa" 

exportOptions_path="$project_path/ExportOptions.plist"

echo "è¾“å‡ºè·¯å¾„ $export_path_ipa"

fastlane gym --export_method development --output_name ${scheme_name} --scheme ${scheme_name} --clean --configuration Release --output_directory ${export_path} --export_options ${exportOptions_path} --export_xcargs -allowProvisioningUpdates

echo "æ‰“åŒ…æ€»ç”¨æ—¶: ${SECONDS}s ~~~~~~~~~~~~~~~~"
echo "

ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ${scheme_name} Release æ‰“åŒ…å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  

"

# if [ "$export_path_ipa" != "" ];then



# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹ä¸Šä¼ è’²å…¬è‹±! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰

# "
# curl -F "file=@$export_path_ipa" -F "uKey=ä½ è‡ªå·±çš„key" -F "_api_key=ä½ è‡ªå·±çš„key" https://qiniu-storage.pgyer.com/apiv1/app/upload


# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  è’²å…¬è‹±ä¸Šä¼ å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

# "


 
# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹ä¸Šä¼ Fir! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰

# "

# fir login "ä½ è‡ªå·±çš„key"
# fir me
# fir publish $export_path_ipa
 
# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  Firä¸Šä¼ å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

# "


# echo "å…±è®¡æ€»ç”¨æ—¶: ${SECONDS}s ~~~~~~~~~~~~~~~~"
# fi

exit