#!/bin/bash

# è®¡æ—¶
SECONDS=0
# è·å–å·¥ç¨‹æ ¹ç›®å½•
fadir()  
{  
    local this_dir=`pwd`  
    local child_dir="$1" 
    dirname "$child_dir" 
    cd $this_dir  
} 
CUR_DIR=$(cd `dirname $0` && pwd -P )
PROJ_BIN=`fadir $CUR_DIR`
echo "å½“å‰æ–‡ä»¶è·¯å¾„ $CUR_DIR"
echo "å½“å‰æ–‡ä»¶è·¯å¾„ä¸Šä¸€çº§ $PROJ_BIN"


echo "

ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹æ‰“åŒ…Debug! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

"
#å·¥ç¨‹ç»å¯¹è·¯å¾„
cd $PROJ_BIN
project_path=$(pwd)
echo "å·¥ç¨‹è·¯å¾„ $project_path"
# è¾“å‡ºåˆ°æ¡Œé¢
output_path=~/Desktop
#è·å–å·¥ç¨‹é»˜è®¤schemeçš„åå­—ï¼ˆé»˜è®¤ä¸å·¥ç¨‹æ–‡ä»¶åå­—ç›¸åŒï¼‰
scheme_name=$(echo $(basename ./*.xcodeproj) | awk -F. '{print $1}')
# è·å–æ—¶é—´ å¦‚:201706011145
current_date="$(date +%Y%m%d_%H%M%S)"
# æŒ‡å®šè¾“å‡ºipaè·¯å¾„
export_path="${output_path}/${scheme_name}_${current_date}"
export_path_ipa="${export_path}/${scheme_name}.ipa" 

exportOptions_path="$project_path/ExportOptions.plist"

echo "Optionsè·¯å¾„ $exportOptions_path"

echo "è¾“å‡ºè·¯å¾„ $export_path_ipa"

fastlane gym --export_method ad-hoc --output_name ${scheme_name} --scheme ${scheme_name} --clean --configuration Debug --output_directory ${export_path} --export_options ${exportOptions_path} --export_xcargs -allowProvisioningUpdates

echo "æ‰“åŒ…æ€»ç”¨æ—¶: ${SECONDS}s ~~~~~~~~~~~~~~~~"
echo "

ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ${scheme_name} Debug æ‰“åŒ…å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

"
# if [ "$export_path_ipa" != "" ];then



# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹ä¸Šä¼ è’²å…¬è‹±! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰

# "
# curl -F "file=@$export_path_ipa" -F "uKey=ä½ è‡ªå·±çš„key" -F "_api_key=ä½ è‡ªå·±çš„key" https://qiniu-storage.pgyer.com/apiv1/app/upload


# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  è’²å…¬è‹±ä¸Šä¼ å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

"


 
# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å¼€å§‹ä¸Šä¼ Fir! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰

# "

# fir login "ä½ è‡ªå·±çš„key"
# fir me
# fir publish $export_path_ipa
 
# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  Firä¸Šä¼ å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

# "


# echo "å…±è®¡æ€»ç”¨æ—¶: ${SECONDS}s ~~~~~~~~~~~~~~~~"

# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ä¼ä¸šå¾®ä¿¡å‡†å¤‡å‘é€æ¶ˆæ¯! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

# "
# curl -o token.txt -s https://qyapi.weixin.qq.com/cgi-bin/gettoken?corpid=ä½ ä¼ä¸šå¾®ä¿¡Key\&corpsecret=ä½ ä¼ä¸šå¾®ä¿¡Key

# token=$(cat token.txt |jq -r '.access_token')
# echo "è¿™é‡Œæ˜¯ä¸€ä¸ªæ–‡ä»¶çš„å†…å®¹ $token"

# App_Name=`find . -name *.xcodeproj | awk -F "[/.]" '{print $(NF-1)}'`

# echo "è¾“å‡ºApp_Name $App_Name"
# Workspace_Path="${project_path}/${App_Name}.xcworkspace"
# Xcodeproj_Path="${project_path}/${App_Name}.xcodeproj"
# # project.pbxprojæ–‡ä»¶è·¯å¾„
# Pbxproj_Path="${Xcodeproj_Path}/project.pbxproj"
# echo "è¾“å‡ºPbxproj_Path $Pbxproj_Path"

# current_data="$(date +%Y-%m-%d_%H:%M:%S)"

# # Pbxproj_PathæŒ‡å‘ project.pbxproj æ–‡ä»¶è·¯å¾„
# configuration=$(grep -i "MARKETING_VERSION =" ${Pbxproj_Path})

# Array=($(echo $configuration))
# # project.pbxproj ä¸­å­˜åœ¨å¤šè¡ŒPRODUCT_BUNDLE_IDENTIFIERä¿¡æ¯ï¼Œä»åå¾€å‰è¯»å–
# MARKETING_VERSION=${Array[5]}
# if [ ! -n $MARKETING_VERSION ]
# then
#     MARKETING_VERSION=${Array[3]}
# fi

# curl -H "Content-Type: application/json" -X POST -d '{"touser" : "","toparty" : "ä½ ä¼ä¸šå¾®ä¿¡åˆ†ç»„id","totag" : "","msgtype" : "text","agentid" : 1000003,"text" : {"content" : "Debugæµ‹è¯•åŒ…'$MARKETING_VERSION'ç‰ˆæœ¬å·²äº'$current_data'æ‰“åŒ…æˆåŠŸ,ä¸‹è½½åœ°å€<a href=\"https://www.pgyer.com/xxx\">ç‚¹å‡»è·³è½¬è’²å…¬è‹±ä¸‹è½½</a>ã€‚"},"safe":0}' https://qyapi.weixin.qq.com/cgi-bin/message/send?access_token=$token
# echo "

# ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  å‘é€æ¶ˆæ¯å®Œæˆ! ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰  ğŸ‰ 

# "
# fi

exit
 
